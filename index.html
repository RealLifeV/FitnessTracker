<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitness Tracker Pro - Full Version</title>
    <style>
        :root { --main-green: #28a745; --bg-dark: #121212; --card-bg: #1e1e1e; }
        
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg-dark); color: white; display: flex; flex-direction: column; align-items: center; padding: 20px; min-height: 100vh; margin: 0; }
        
        /* Men√º Icon oben rechts */
        #menuIcon { position: absolute; top: 20px; right: 20px; cursor: pointer; font-size: 1.5rem; z-index: 10; color: var(--main-green); }

        /* Datum Navigation */
        .date-nav { display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 20px; width: 100%; max-width: 500px; margin-top: 40px; }
        .date-nav button { background: #333; border: none; color: white; padding: 10px 15px; border-radius: 10px; cursor: pointer; }
        .date-display { text-align: center; }
        .date-display h2 { margin: 0; font-size: 1.5rem; color: var(--main-green); }
        .date-display span { font-size: 0.9rem; color: #888; }

        /* Dashboard Karte */
        .dashboard-card { background: var(--card-bg); border: 2px solid #333; border-radius: 20px; padding: 25px; width: 100%; max-width: 450px; display: flex; align-items: center; justify-content: center; gap: 40px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); cursor: pointer; }
        .progress-circle { width: 140px; height: 140px; border-radius: 50%; background: radial-gradient(var(--card-bg) 60%, transparent 61%), conic-gradient(var(--main-green) 0% 0%, #333 0% 100%); display: flex; align-items: center; justify-content: center; text-align: center; font-size: 0.85rem; font-weight: bold; flex-shrink: 0; }
        .stats { display: flex; flex-direction: column; gap: 12px; font-size: 1rem; }
        .stat-item span { color: #888; font-size: 0.8rem; display: block; }

        /* Eingabe-Sektion */
        .input-section { background: var(--card-bg); padding: 20px; border-radius: 20px; width: 100%; max-width: 500px; margin-top: 20px; border: 1px solid #333; box-sizing: border-box; }
        .tab-container { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn { flex: 1; padding: 12px; border: 1px solid #444; background: #2a2a2a; color: #888; border-radius: 12px; cursor: pointer; font-weight: bold; }
        .tab-btn.active { background: var(--main-green); color: white; border-color: var(--main-green); }

        .grid-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .nutrient-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }

        input { width: 100%; padding: 12px; background: #333; color: white; border: 1px solid #444; border-radius: 8px; box-sizing: border-box; margin-bottom: 5px; }
        label { font-size: 0.8rem; color: #888; margin-top: 5px; display: block; }
        
        /* Buttons */
        .action-btns { display: flex; gap: 10px; margin-top: 15px; }
        .btn-secondary { background: #444; flex: 1; font-size: 0.85rem; padding: 10px; border: none; color: white; border-radius: 8px; cursor: pointer; }
        .btn-main { background: var(--main-green); margin-top: 15px; font-size: 1.1rem; padding: 14px; width: 100%; border: none; color: white; border-radius: 12px; cursor: pointer; font-weight: bold; }

        /* Listen-Design (Eintr√§ge & Vorlagen) */
        ul { list-style: none; padding: 0; width: 100%; max-width: 500px; margin-top: 20px; }
        li { background: #222; margin-bottom: 8px; padding: 12px 15px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid var(--main-green); }
        .delete-btn { color: #888; cursor: pointer; font-weight: bold; padding: 5px 10px; }
        .delete-btn:hover { color: #ff4d4d; }

        /* Modals */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 100; justify-content: center; align-items: center; }
        .modal-content { background: var(--card-bg); padding: 30px; border-radius: 25px; width: 90%; max-width: 400px; border: 1px solid #333; max-height: 80vh; overflow-y: auto; }
        
        /* Vorlagen Liste im Modal */
        .template-item { background: #333; padding: 10px; border-radius: 8px; margin-bottom: 10px; cursor: pointer; display: flex; justify-content: space-between; }
        .template-item:hover { background: #444; }

        /* Balken */
        .nutrient-bar-container { margin-bottom: 15px; }
        .bar-bg { background: #333; height: 10px; border-radius: 5px; overflow: hidden; margin-top: 5px; }
        .bar-fill { height: 100%; background: var(--main-green); width: 0%; transition: width 0.5s; }
    </style>
</head>
<body>

    <div id="menuIcon" onclick="toggleModal('settingsModal')">‚ò∞</div>

    <div class="date-nav">
        <button onclick="changeDate(-1)">‚ùÆ</button>
        <div class="date-display">
            <h2 id="dayLabel">Heute</h2>
            <span id="dateLabel">02.02.2026</span>
        </div>
        <button onclick="changeDate(1)">‚ùØ</button>
    </div>

    <div class="dashboard-card" onclick="openNutrients()">
        <div class="progress-circle" id="circle">
            <div id="remainingLabel">Verbleibend<br><span id="remainingValue" style="font-size: 1.3rem;">2000</span></div>
        </div>
        <div class="stats">
            <div class="stat-item"><span>Grundziel:</span><b id="goalValue">2000</b> kcal</div>
            <div class="stat-item"><span>Ern√§hrung:</span><b id="foodValue">0</b> kcal</div>
            <div class="stat-item"><span>Training:</span><b id="workoutValue">0</b> kcal</div>
        </div>
    </div>

    <div class="input-section">
        <div class="tab-container">
            <button id="tabFood" class="tab-btn active" onclick="setMode('food')">üçé Essen</button>
            <button id="tabWorkout" class="tab-btn" onclick="setMode('workout')">üí™ Training</button>
        </div>
        <div class="grid-inputs">
            <input type="text" id="nameInput" placeholder="Name">
            <input type="number" id="calInput" placeholder="Kalorien">
        </div>
        <div id="nutrientFields" class="nutrient-grid">
            <input type="number" id="protInput" placeholder="Proteine">
            <input type="number" id="carbInput" placeholder="Kohlenhydrate">
            <input type="number" id="fatInput" placeholder="Fette">
            <input type="number" id="sugInput" placeholder="Zucker">
            <input type="number" id="fibInput" placeholder="Ballaststoffe">
        </div>
        
        <div class="action-btns">
            <button class="btn-secondary" onclick="saveTemplate()">üíæ Speichern</button>
            <button class="btn-secondary" onclick="toggleModal('templateModal')">üìã Liste</button>
        </div>
        
        <button class="btn-main" onclick="confirmEntry()">Eintrag Best√§tigen</button>
    </div>

    <ul id="entryList"></ul>

    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <h3>Tagesziele festlegen</h3>
            <label>Kalorien Ziel:</label> <input type="number" id="goalInput">
            <label>Proteine (g):</label> <input type="number" id="goalProt">
            <label>Kohlenhydrate (g):</label> <input type="number" id="goalCarb">
            <label>Fette (g):</label> <input type="number" id="goalFat">
            <label>Zucker (g):</label> <input type="number" id="goalSug">
            <label>Ballaststoffe (g):</label> <input type="number" id="goalFib">
            <button class="btn-main" onclick="saveGoals()">Ziele Speichern</button>
            <button class="btn-secondary" onclick="toggleModal('settingsModal')" style="width:100%; margin-top:10px;">Schlie√üen</button>
        </div>
    </div>

    <div id="templateModal" class="modal">
        <div class="modal-content">
            <h3>Gespeicherte Vorlagen</h3>
        
            <div class="tab-container" style="margin-bottom: 10px;">
                <button id="tabTplFood" class="tab-btn active" onclick="renderTemplates('food')">üçé Essen</button>
                <button id="tabTplWorkout" class="tab-btn" onclick="renderTemplates('workout')">üí™ Training</button>
            </div>

            <div style="margin-bottom: 15px;">
                <input type="text" id="templateSearch" placeholder="Suchen..." onkeyup="renderTemplates()" style="margin-bottom: 0;">
            </div>

            <div id="templateListContainer" style="max-height: 40vh; overflow-y: auto;">
                </div>
        
            <button class="btn-secondary" onclick="toggleModal('templateModal')" style="width:100%; margin-top:15px;">Schlie√üen</button>
        </div>
    </div>

    <div id="nutrientsModal" class="modal">
        <div class="modal-content">
            <h3>Tages√ºbersicht N√§hrwerte</h3>
            <div id="nutrientBars"></div>
            <button class="btn-main" onclick="toggleModal('nutrientsModal')">Schlie√üen</button>
        </div>
    </div>

<script>
    // --- Initialisierung & Variablen ---
    let currentViewDate = new Date();
    let currentMode = 'food';
    // Standard-Ziele laden
    let goals = JSON.parse(localStorage.getItem("fitnessGoals")) || { cal: 2000, p: 150, c: 250, f: 70, s: 50, fib: 30 };

    // --- Hilfsfunktionen ---
    function getDateKey(date) { return date.toISOString().split('T')[0]; } // Formatiert Datum zu YYYY-MM-DD

    // Modal umschalten
    function toggleModal(id) {
        const modal = document.getElementById(id);
        modal.style.display = (modal.style.display === "flex") ? "none" : "flex";
        if(id === 'settingsModal') fillSettingsFields(); // Felder im Men√º f√ºllen
        if(id === 'templateModal') renderTemplates();   // Vorlagen-Liste beim √ñffnen bauen
    }

    // --- Datums-Steuerung ---
    function changeDate(offset) {
        currentViewDate.setDate(currentViewDate.getDate() + offset);
        updateDateUI();
        updateDashboard();
        renderEntryList();
    }

    function updateDateUI() {
        const today = new Date();
        const isToday = currentViewDate.toDateString() === today.toDateString();
        document.getElementById('dayLabel').innerText = isToday ? "Heute" : currentViewDate.toLocaleDateString('de-DE', { weekday: 'long' });
        document.getElementById('dateLabel').innerText = currentViewDate.toLocaleDateString('de-DE');
    }

    // --- Ziele & Einstellungen ---
    function fillSettingsFields() {
        document.getElementById('goalInput').value = goals.cal;
        document.getElementById('goalProt').value = goals.p;
        document.getElementById('goalCarb').value = goals.c;
        document.getElementById('goalFat').value = goals.f;
        document.getElementById('goalSug').value = goals.s;
        document.getElementById('goalFib').value = goals.fib;
    }

    function saveGoals() {
        goals = {
            cal: parseInt(document.getElementById('goalInput').value) || 2000,
            p: parseInt(document.getElementById('goalProt').value) || 0,
            c: parseInt(document.getElementById('goalCarb').value) || 0,
            f: parseInt(document.getElementById('goalFat').value) || 0,
            s: parseInt(document.getElementById('goalSug').value) || 0,
            fib: parseInt(document.getElementById('goalFib').value) || 0
        };
        localStorage.setItem("fitnessGoals", JSON.stringify(goals));
        updateDashboard();
        toggleModal('settingsModal');
    }

    // --- Modus & Eingabe ---
    function setMode(mode) {
        currentMode = mode;
        document.getElementById('tabFood').classList.toggle('active', mode === 'food');
        document.getElementById('tabWorkout').classList.toggle('active', mode === 'workout');
        document.getElementById('nutrientFields').style.display = (mode === 'food') ? 'grid' : 'none';
    }

    function confirmEntry() {
        const name = document.getElementById('nameInput').value;
        const cals = document.getElementById('calInput').value;
        if (!name || !cals) return alert("Name und Kalorien fehlen!");

        const entry = {
            id: Date.now(),
            title: name,
            calories: parseInt(cals),
            type: currentMode,
            p: Number(document.getElementById('protInput').value) || 0,
            c: Number(document.getElementById('carbInput').value) || 0,
            f: Number(document.getElementById('fatInput').value) || 0,
            s: Number(document.getElementById('sugInput').value) || 0,
            fib: Number(document.getElementById('fibInput').value) || 0
        };

        const key = "data-" + getDateKey(currentViewDate);
        const dayEntries = JSON.parse(localStorage.getItem(key)) || [];
        dayEntries.push(entry);
        localStorage.setItem(key, JSON.stringify(dayEntries));

        renderEntryList();
        updateDashboard();
        resetInputs();
    }

    // --- Vorlagen-System ---
    // Variable, um zu wissen, welchen Tab wir im Vorlagen-Modal gerade sehen
let currentTemplateView = 'food';

// Speichert eine Vorlage basierend auf dem aktuellen Modus (food/workout)
function saveTemplate() {
    const name = document.getElementById('nameInput').value;
    const cals = document.getElementById('calInput').value;
    
    if (!name || !cals) return alert("Gib erst Daten ein, um sie zu speichern.");

    const template = {
        title: name,
        calories: parseInt(cals),
        type: currentMode, // Speichert, ob es Essen oder Training war
        p: Number(document.getElementById('protInput').value) || 0,
        c: Number(document.getElementById('carbInput').value) || 0,
        f: Number(document.getElementById('fatInput').value) || 0,
        s: Number(document.getElementById('sugInput').value) || 0,
        fib: Number(document.getElementById('fibInput').value) || 0
    };

    const templates = JSON.parse(localStorage.getItem("fitnessTemplates")) || [];
    templates.push(template);
    localStorage.setItem("fitnessTemplates", JSON.stringify(templates));
    alert(currentMode === 'food' ? "Essen gespeichert!" : "Training gespeichert!");
}

// Zeigt die Vorlagen gefiltert nach Typ an
// Variable f√ºr den Suchbegriff

function renderTemplates(mode = currentTemplateView) {
    currentTemplateView = mode; 
    
    // UI der Tabs aktualisieren
    document.getElementById('tabTplFood').classList.toggle('active', mode === 'food');
    document.getElementById('tabTplWorkout').classList.toggle('active', mode === 'workout');

    const container = document.getElementById('templateListContainer');
    const searchInput = document.getElementById('templateSearch').value.toLowerCase(); // Suchtext klein schreiben
    const allTemplates = JSON.parse(localStorage.getItem("fitnessTemplates")) || [];
    
    // 1. Filtern nach Typ (food/workout) 
    // 2. Filtern nach Suchbegriff
    const filtered = allTemplates.filter(t => {
        const matchesType = t.type === mode;
        const matchesSearch = t.title.toLowerCase().includes(searchInput);
        return matchesType && matchesSearch;
    });
    
    container.innerHTML = filtered.length === 0 ? `<p style="text-align:center; color:#888;">Nichts gefunden.</p>` : "";

    // Wir nutzen hier wieder den originalen Index f√ºr Load/Delete
    allTemplates.forEach((t, originalIndex) => {
        const matchesType = t.type === mode;
        const matchesSearch = t.title.toLowerCase().includes(searchInput);

        if (matchesType && matchesSearch) {
            const div = document.createElement("div");
            div.className = "template-item";
            div.innerHTML = `
                <div onclick="loadTemplate(${originalIndex})" style="flex-grow:1">
                    <b>${t.title}</b><br><small>${t.calories} kcal</small>
                </div>
                <span class="delete-btn" onclick="deleteTemplate(${originalIndex})" style="color:#c0392b">‚úï</span>
            `;
            container.appendChild(div);
        }
    });
}

function loadTemplate(index) {
    const templates = JSON.parse(localStorage.getItem("fitnessTemplates"));
    const t = templates[index];
    
    // Modus der App an die Vorlage anpassen
    setMode(t.type);
    
    // Felder f√ºllen
    document.getElementById('nameInput').value = t.title;
    document.getElementById('calInput').value = t.calories;
    
    if (t.type === 'food') {
        document.getElementById('protInput').value = t.p;
        document.getElementById('carbInput').value = t.c;
        document.getElementById('fatInput').value = t.f;
        document.getElementById('sugInput').value = t.s;
        document.getElementById('fibInput').value = t.fib;
    }
    
    toggleModal('templateModal');
}

    function deleteTemplate(index) {
        let templates = JSON.parse(localStorage.getItem("fitnessTemplates"));
        templates.splice(index, 1);
        localStorage.setItem("fitnessTemplates", JSON.stringify(templates));
        renderTemplates();
    }

    // --- Dashboard & Listen ---
    function deleteEntry(id) {
        const key = "data-" + getDateKey(currentViewDate);
        let entries = JSON.parse(localStorage.getItem(key)) || [];
        entries = entries.filter(e => e.id !== id);
        localStorage.setItem(key, JSON.stringify(entries));
        renderEntryList();
        updateDashboard();
    }

    function renderEntryList() {
        const key = "data-" + getDateKey(currentViewDate);
        const entries = JSON.parse(localStorage.getItem(key)) || [];
        const list = document.getElementById('entryList');
        list.innerHTML = "";
        
        entries.slice().reverse().forEach(entry => {
            const li = document.createElement("li");
            li.innerHTML = `
                <div>
                    <span>${entry.title}</span><br>
                    <small style="color:#888">${entry.type === 'food' ? 'Essen' : 'Training'}</small>
                </div>
                <div style="display:flex; align-items:center; gap:15px">
                    <strong>${entry.type === 'food' ? '-' : '+'}${entry.calories} kcal</strong>
                    <span class="delete-btn" onclick="deleteEntry(${entry.id})">‚úï</span>
                </div>`;
            list.appendChild(li);
        });
    }

    function updateDashboard() {
        const key = "data-" + getDateKey(currentViewDate);
        const entries = JSON.parse(localStorage.getItem(key)) || [];
        let food = 0, workout = 0;
        entries.forEach(e => { if(e.type === 'food') food += e.calories; else workout += e.calories; });

        const net = Math.max(0, food - workout);
        const progress = Math.min((net / goals.cal) * 100, 100);
        
        document.getElementById('goalValue').innerText = goals.cal;
        document.getElementById('foodValue').innerText = food;
        document.getElementById('workoutValue').innerText = workout;
        document.getElementById('remainingValue').innerText = goals.cal - food + workout;
        document.getElementById('circle').style.background = `radial-gradient(var(--card-bg) 60%, transparent 61%), conic-gradient(var(--main-green) 0% ${progress}%, #333 ${progress}% 100%)`;
    }

    function openNutrients() {
        const key = "data-" + getDateKey(currentViewDate);
        const entries = JSON.parse(localStorage.getItem(key)) || [];
        const sums = { p: 0, c: 0, f: 0, s: 0, fib: 0 };
        entries.forEach(e => { if(e.type === 'food') { sums.p += e.p; sums.c += e.c; sums.f += e.f; sums.s += e.s; sums.fib += e.fib; }});

        const container = document.getElementById('nutrientBars');
        container.innerHTML = "";
        const config = [
            {l:'Proteine', k:'p', g: goals.p}, {l:'Kohlenhydrate', k:'c', g: goals.c}, 
            {l:'Fette', k:'f', g: goals.f}, {l:'Zucker', k:'s', g: goals.s}, {l:'Ballaststoffe', k:'fib', g: goals.fib}
        ];
        config.forEach(n => {
            const perc = n.g > 0 ? Math.min((sums[n.k] / n.g) * 100, 100) : 0;
            container.innerHTML += `
                <div class="nutrient-bar-container">
                    <div style="display:flex; justify-content:space-between; font-size:0.85rem"><span>${n.l}</span><span>${sums[n.k].toFixed(1)} / ${n.g}</span></div>
                    <div class="bar-bg"><div class="bar-fill" style="width:${perc}%"></div></div>
                </div>`;
        });
        toggleModal('nutrientsModal');
    }

    function resetInputs() {
        ['nameInput', 'calInput', 'protInput', 'carbInput', 'fatInput', 'sugInput', 'fibInput'].forEach(id => document.getElementById(id).value = "");
    }

    // Beim Laden der Seite alles initialisieren
    window.onload = () => { updateDateUI(); updateDashboard(); renderEntryList(); };
</script>
</body>
</html>